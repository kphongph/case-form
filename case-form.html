<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../core-selector/core-selector.html">
<link rel="import" href="../core-toolbar/core-toolbar.html">

<link rel="import" href="questions/case-question-single-select.html">
<link rel="import" href="form-datasource.html">

<polymer-element name="case-form" attributes="src">
  <template>
    <link rel="stylesheet" href="case-form.css">
    
    <form-datasource url="{{src}}" form="{{form}}"></form-datasource>
    <core-toolbar cross-fade-delayed>
      <div flex>{{question.question}}</div>
    </core-toolbar>

    <core-selector id="questionView" 
      on-question-answered="{{questionAnswered}}"
      cross-fade-delayed
      notap selected="{{question.type}}">
      <case-question-single-select name="single-select">
      </case-question-single-select>
    </core-selector>
    
    <template if="{{answered}}">
    <paper-button raised on-tap="{{questionDone}}">Next</paper-button>
    </template>
  </template>

  <script>
    Polymer('case-form',{
      answered:false,
      observe: { 
        'form':'update'
      },
      ready: function() {
      },
      update: function() {
        console.log('update');
        if(this.form) {
          this.index = 0;
        }
      },
      indexChanged: function() {
        if(this.form.questions) { 
          if(this.form.questions.length > this.index) {
            this.question = this.form.questions[this.index];
          } else {
            this.fire('form-done');
            this.questionView.reset();
          }
        }
      },
      questionChanged: function() {
        if(this.questionView) {
          this.questionView.reset();
        } 

        if(this.question) {
          this.questionView = this.$.questionView.querySelector(
           '[name="'+this.question.type+'"]');
          if(this.questionView) {
            this.questionView.question = this.question;
          }
        }
      },
      questionAnswered: function() {
        this.answered = true;
      },
      questionDone: function() {
        this.next();
      },
      next:function() {
        this.index++;
        this.answered = false;
        if(this.questionView) {
          this.questionView.reset();
        }
      }
    });
  </script>

</polymer-element>
